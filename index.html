<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Eastern University Transport — Dashboard</title>
<!--
  Ready-to-use single-file dashboard:
  - Save as index.html, put images (eu.jpeg, profile.jpeg, mizen.jpeg) in same folder if available.
  - Open in browser (Chrome/Edge recommended). Data stored in localStorage.
-->
<style>
  :root{
    --bg:#f3f7fc; --card:#ffffff; --muted:#5b6b79; --primary:#0b5cff; --accent:#ff6b35;
    --yes:#16a34a; --no:#ef4444; --pending:#f59e0b;
  }
  *{box-sizing:border-box}
  body{font-family:Inter, "Segoe UI", Arial, sans-serif; margin:0; background:var(--bg); color:#0b1220}
  .wrap{max-width:1100px;margin:18px auto;padding:14px}
  /* Header */
  .hero{background:linear-gradient(135deg,var(--primary),#5b21b6); color:#fff; border-radius:12px; padding:22px; text-align:center; box-shadow:0 8px 30px rgba(37,117,252,0.12)}
  .logo-big{width:120px;height:120px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.12);font-weight:800;font-size:34px;margin-bottom:8px;border:4px solid rgba(255,255,255,0.12)}
  .title{font-size:22px;margin:0 0 6px 0;font-weight:800}
  .subtitle{opacity:0.9;margin:0;font-size:14px}
  /* Cards */
  .card{background:var(--card);padding:14px;border-radius:12px;margin-top:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
  .row{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
  .col{flex:1;min-width:260px}
  .small{font-size:13px;color:var(--muted)}
  label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px}
  input,select,textarea,button{font-size:14px;padding:10px;border-radius:8px;border:1px solid #e6eef6;width:100%;box-sizing:border-box}
  button{cursor:pointer}
  .btn{background:var(--primary);color:#fff;border:none;padding:10px 12px;border-radius:8px}
  .btn.ghost{background:transparent;border:1px solid rgba(11,92,255,0.15);color:var(--primary)}
  .btn.warn{background:var(--accent)}
  .chip{display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--primary),#6a11cb);color:#fff;margin:4px;font-weight:700}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:left}
  th{background:var(--primary);color:#fff}
  .profile{display:flex;gap:12px;align-items:center}
  .profile img{width:72px;height:72px;border-radius:10px;object-fit:cover;border:3px solid #fff;box-shadow:0 8px 20px rgba(0,0,0,0.08)}
  .status{padding:6px 8px;border-radius:8px;color:#fff;font-weight:700}
  .s-pending{background:var(--pending)}
  .s-yes{background:var(--yes)}
  .s-no{background:var(--no)}
  .summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:10px;margin-top:10px}
  .summary-item{background:linear-gradient(180deg,#fff,#fbfdff);padding:12px;border-radius:10px;box-shadow:0 6px 14px rgba(2,6,23,0.04)}
  .muted{color:var(--muted)}
  .input-inline{display:flex;gap:8px}
  .input-inline > *{flex:1}
  @media(max-width:800px){.row{flex-direction:column}}
</style>
</head>
<body>
  <div class="wrap">

    <!-- HEADER -->
    <div class="hero">
      <div class="logo-big" id="logoBox">
        <!-- if image available, will replace -->
        EU
      </div>
      <div class="title">Eastern University</div>
      <div class="subtitle">Transport Dashboard — রোজকার যাত্রী অনুমান ও ড্রাইভার সমন্বয়</div>
    </div>

    <!-- PROFILE -->
    <div class="card" id="profileCard">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
        <h3 style="margin:0">Contact & Profiles</h3>
        <div class="small muted">Contact officers in case of issues</div>
      </div>
      <div class="row" style="margin-top:12px">
        <div class="col profile">
          <img id="p1" src="profile.jpeg" alt="Md. Sahihen" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;72&quot; height=&quot;72&quot;><rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;#e6eef6&quot;/><text x=&quot;50%&quot; y=&quot;55%&quot; dominant-baseline=&quot;middle&quot; text-anchor=&quot;middle&quot; fill=&quot;#94a3b8&quot; font-size=&quot;22&quot;>S</text></svg>'" />
          <div>
            <div style="font-weight:800">Md. Sahihen</div>
            <div class="small muted">Assistant Director of Transport</div>
            <div class="small muted">Mobile: <strong id="p1phone">01962419405</strong></div>
          </div>
        </div>

        <div class="col profile">
          <img id="p2" src="mizen.jpeg" alt="Mizanur Rahman" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;72&quot; height=&quot;72&quot;><rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;#e6eef6&quot;/><text x=&quot;50%&quot; y=&quot;55%&quot; dominant-baseline=&quot;middle&quot; text-anchor=&quot;middle&quot; fill=&quot;#94a3b8&quot; font-size=&quot;22&quot;>M</text></svg>'" />
          <div>
            <div style="font-weight:800">Mizanur Rahman</div>
            <div class="small muted">Senior In-charge of Transport</div>
            <div class="small muted">Mobile: <strong id="p2phone">01911090134</strong></div>
          </div>
        </div>

        <div style="flex-basis:320px" class="col">
          <div style="font-weight:700;margin-bottom:6px">Quick Info</div>
          <div class="small muted">- Submit requests between <strong>5:00 PM — 10:00 PM</strong>.</div>
          <div class="small muted">- Admin can add/edit routes & drivers below.</div>
        </div>
      </div>
    </div>

    <!-- ADMIN: Config / Routes & Drivers -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
        <h3 style="margin:0">Route & Driver Management <span class="small muted" style="margin-left:8px">(Admin)</span></h3>
        <div class="small muted">Add / edit routes and driver contacts (saved locally)</div>
      </div>

      <div style="margin-top:12px" class="row">
        <div class="col">
          <label>New Route name (নতুন রোড)</label>
          <div class="input-inline">
            <input id="newRoute" placeholder="e.g. Rampara">
            <button class="btn" id="addRouteBtn">Add Route</button>
          </div>
        </div>
        <div class="col">
          <label>Assign Driver (Route|Name|Phone)</label>
          <div class="input-inline">
            <input id="newDriver" placeholder="Format: Rampara|Kabir Hossain|017xxxxxxxx">
            <button class="btn" id="addDriverBtn">Add / Update</button>
          </div>
        </div>
        <div class="col">
          <label>Seats per vehicle</label>
          <input id="seatsPerBus" type="number" value="30" min="1">
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="small muted">Existing Routes</div>
        <div id="routesChips" style="margin-top:8px"></div>

        <table id="driversTable" style="margin-top:10px">
          <thead><tr><th>Route</th><th>Driver</th><th>Phone</th><th>Action</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

    </div>

    <!-- CHECK-IN (Student / Faculty) -->
    <div class="card" id="checkinCard" style="background:linear-gradient(135deg,#fff,#f8fbff)">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
        <h3 style="margin:0">Request Form — রিকোয়েস্ট ফর্ম</h3>
        <div class="small muted">Name + ID + Pickup location</div>
      </div>

      <div style="margin-top:12px" class="grid cols-3">
        <div>
          <label>নাম / Name</label>
          <input id="stuName" placeholder="Full name">
        </div>
        <div>
          <label>আইডি / ID (or Mobile)</label>
          <input id="stuId" placeholder="Student ID or Mobile">
        </div>
        <div>
          <label>Pickup Location</label>
          <select id="stuLocation"><option value="">-- Select --</option></select>
        </div>
        <div>
          <label>Phone (optional)</label>
          <input id="stuPhone" placeholder="Mobile (optional)">
        </div>
        <div style="align-self:center">
          <label>&nbsp;</label>
          <button class="btn" id="submitReqBtn">Send Request / রিকোয়েস্ট</button>
        </div>
        <div>
          <label>&nbsp;</label>
          <div id="reqMsg" class="small" style="color:green"></div>
        </div>
      </div>
      <div class="small muted" style="margin-top:10px">Note: Requests accepted between 17:00 — 22:00. Outside this window submissions are blocked.</div>
    </div>

    <!-- REQUESTS & ACTIONS -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
        <h3 style="margin:0">Today's Requests — আজকের রিকোয়েস্টসমূহ</h3>
        <div style="display:flex;gap:8px">
          <button class="btn" id="downloadReportPdf">Generate Final Report (PDF)</button>
          <button class="btn.ghost" id="downloadCsv">Download CSV</button>
        </div>
      </div>

      <div style="margin-top:12px;overflow:auto">
        <table id="requestsTable" style="width:100%">
          <thead><tr><th>Time</th><th>Name</th><th>ID</th><th>Phone</th><th>Pickup</th><th>Status</th><th>Action</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div style="margin-top:10px">
        <div class="small muted">Action: Click <strong>Yes</strong> when rider boards (this marks Approved).</div>
      </div>
    </div>

    <!-- SUMMARY -->
    <div class="card">
      <h3 style="margin:0">Live Summary — Route-wise passengers</h3>
      <div class="summary-grid" id="summaryGrid"></div>
      <div class="small muted" style="margin-top:10px">Approved = boarded. Pending = requested but not yet boarded.</div>
    </div>

  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
/* --------------------------
  State (persist in localStorage)
--------------------------- */
const STORAGE_KEY = 'eu_transport_dashboard_v2';
let state = loadState();

function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) return JSON.parse(raw);
  }catch(e){}
  // default
  return {
    routes: ["Rampara","Dhanmondi","Malibagh","NarayanGanj","Chashara","Gulshan"],
    drivers: [
      {route:"Rampara", name:"Kabir Hossain", phone:"01711111111"},
      {route:"Dhanmondi", name:"Kamal Uddin", phone:"01722222222"},
      {route:"Malibagh", name:"Sazzad Hossain", phone:"01733333333"}
    ],
    seatsPerBus: 30,
    requests: [] // {id, timeISO, name, sid, phone, pickup, status}
  };
}
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

/* --------------------------
  DOM refs
--------------------------- */
const routesChips = document.getElementById('routesChips');
const driversTableBody = document.querySelector('#driversTable tbody');
const routesSelect = document.getElementById('stuLocation');
const requestsTbody = document.querySelector('#requestsTable tbody');
const summaryGrid = document.getElementById('summaryGrid');
const seatsPerBusInput = document.getElementById('seatsPerBus');

/* --------------------------
  Init UI
--------------------------- */
function init(){
  renderRoutesDrivers();
  renderRequests();
  renderSummary();
  seatsPerBusInput.value = state.seatsPerBus || 30;
}
init();

/* --------------------------
  Routes & Drivers render
--------------------------- */
function renderRoutesDrivers(){
  // chips
  routesChips.innerHTML = '';
  state.routes.forEach(r=>{
    const d = document.createElement('div'); d.className='chip'; d.textContent=r;
    routesChips.appendChild(d);
  });
  // drivers table
  driversTableBody.innerHTML = '';
  state.routes.forEach(r=>{
    const driver = state.drivers.find(x=>x.route===r);
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r}</td>
      <td>${driver?escapeHtml(driver.name):'<em>Not assigned</em>'}</td>
      <td>${driver?escapeHtml(driver.phone):'-'}</td>
      <td>
        <button class="btn.ghost" onclick="editDriverPrompt('${r.replace(/'/g,"\\'")}')">Edit</button>
        <button class="btn.ghost" onclick="deleteDriver('${r.replace(/'/g,"\\'")}')" style="margin-left:6px">Delete</button>
      </td>`;
    driversTableBody.appendChild(tr);
  });
  // pickup select
  routesSelect.innerHTML = '<option value="">-- Select pickup location --</option>';
  state.routes.forEach(r=>{
    const o = document.createElement('option'); o.value = r; o.textContent = r; routesSelect.appendChild(o);
  });
  // save
  saveState();
}

/* --------------------------
  Add route / add driver (admin)
--------------------------- */
document.getElementById('addRouteBtn').addEventListener('click', ()=>{
  const v = document.getElementById('newRoute').value.trim();
  if(!v){ alert('Route name required'); return; }
  if(state.routes.includes(v)){ alert('Route already exists'); document.getElementById('newRoute').value=''; return; }
  state.routes.push(v);
  document.getElementById('newRoute').value='';
  renderRoutesDrivers();
  renderSummary();
});

document.getElementById('addDriverBtn').addEventListener('click', ()=>{
  const v = document.getElementById('newDriver').value.trim();
  if(!v){ alert('Enter in format: Route|Driver Name|Phone'); return; }
  const parts = v.split('|').map(x=>x.trim());
  if(parts.length < 3){ alert('Format: Route|Driver Name|Phone'); return; }
  const [route,name,phone] = parts;
  // update driver or add
  const idx = state.drivers.findIndex(d=>d.route===route);
  if(idx>=0){ state.drivers[idx] = {route,name,phone}; }
  else { state.drivers.push({route,name,phone}); if(!state.routes.includes(route)){ state.routes.push(route); } }
  document.getElementById('newDriver').value='';
  renderRoutesDrivers();
});

/* edit/delete driver */
window.editDriverPrompt = function(route){
  const driver = state.drivers.find(x=>x.route===route) || {name:'',phone:''};
  const name = prompt('Driver name for '+route, driver.name);
  if(name===null) return;
  const phone = prompt('Phone for '+route, driver.phone);
  if(phone===null) return;
  // update or add
  const idx = state.drivers.findIndex(d=>d.route===route);
  if(idx>=0) state.drivers[idx] = {route,name,phone};
  else state.drivers.push({route,name,phone});
  renderRoutesDrivers();
};
window.deleteDriver = function(route){
  if(!confirm('Remove driver record for '+route+'?')) return;
  state.drivers = state.drivers.filter(d=>d.route!==route);
  renderRoutesDrivers();
};

/* seats change */
seatsPerBusInput.addEventListener('change', ()=>{
  state.seatsPerBus = Number(seatsPerBusInput.value) || state.seatsPerBus;
  saveState();
  renderSummary();
});

/* --------------------------
  Request submit (Student/Faculty)
--------------------------- */
document.getElementById('submitReqBtn').addEventListener('click', ()=>{
  const name = document.getElementById('stuName').value.trim();
  const sid = document.getElementById('stuId').value.trim();
  const phone = document.getElementById('stuPhone').value.trim();
  const pickup = document.getElementById('stuLocation').value;
  const now = new Date();
  const hour = now.getHours();
  const msgEl = document.getElementById('reqMsg');

  if(hour < 17 || hour >= 22){
    msgEl.style.color = '#ffdddd'; msgEl.textContent = 'Request window closed — allowed 17:00–22:00';
    return;
  }
  if(!name || !sid || !pickup){ msgEl.style.color = '#ffdddd'; msgEl.textContent = 'Name, ID and Pickup required'; return; }

  const rec = { id: 'req'+Date.now(), timeISO: new Date().toISOString(), name, sid, phone, pickup, status:'Pending' };
  state.requests.push(rec);
  saveState();
  document.getElementById('stuName').value=''; document.getElementById('stuId').value=''; document.getElementById('stuPhone').value='';
  msgEl.style.color='#0b6623'; msgEl.textContent = 'Request recorded — ধন্যবাদ';
  renderRequests();
  renderSummary();
});

/* --------------------------
  Render requests (today)
--------------------------- */
function renderRequests(){
  requestsTbody.innerHTML = '';
  // show today's requests (by date)
  const todayKey = (new Date()).toISOString().slice(0,10);
  const todays = state.requests.filter(r => r.timeISO.slice(0,10) === todayKey);
  // newest first
  todays.slice().reverse().forEach(r=>{
    const tr = document.createElement('tr');
    const time = new Date(r.timeISO).toLocaleTimeString();
    const statusLabel = (r.status==='Pending') ? `<span class="status s-pending">Pending</span>` 
                         : (r.status==='Approved') ? `<span class="status s-yes">Yes</span>` 
                         : `<span class="status s-no">No</span>`;
    const action = (r.status==='Pending') 
      ? `<button class="btn" onclick="markYes('${r.id}')">Yes</button><button class="btn.ghost" style="margin-left:6px" onclick="markNo('${r.id}')">No</button>`
      : `<button class="btn.ghost" onclick="undo('${r.id}')">Undo</button>`;
    tr.innerHTML = `<td>${time}</td>
      <td>${escapeHtml(r.name)}</td>
      <td>${escapeHtml(r.sid)}</td>
      <td>${escapeHtml(r.phone||'-')}</td>
      <td>${escapeHtml(r.pickup)}</td>
      <td>${statusLabel}</td>
      <td>${action}</td>`;
    requestsTbody.appendChild(tr);
  });
}

/* actions */
window.markYes = function(id){
  const idx = state.requests.findIndex(x=>x.id===id); if(idx===-1) return;
  state.requests[idx].status = 'Approved'; saveState(); renderRequests(); renderSummary();
};
window.markNo = function(id){
  const idx = state.requests.findIndex(x=>x.id===id); if(idx===-1) return;
  state.requests[idx].status = 'No'; saveState(); renderRequests(); renderSummary();
};
window.undo = function(id){
  const idx = state.requests.findIndex(x=>x.id===id); if(idx===-1) return;
  state.requests[idx].status = 'Pending'; saveState(); renderRequests(); renderSummary();
};

/* --------------------------
  Summary (route-wise counts)
--------------------------- */
function renderSummary(){
  summaryGrid.innerHTML = '';
  const seats = Number(state.seatsPerBus) || 30;
  state.routes.forEach(route=>{
    const approved = state.requests.filter(r=>r.pickup===route && r.status==='Approved').length;
    const pending = state.requests.filter(r=>r.pickup===route && r.status==='Pending').length;
    const drivers = state.drivers.find(d=>d.route===route);
    const vehicles = Math.ceil(approved / seats);
    const div = document.createElement('div'); div.className='summary-item';
    div.innerHTML = `<div style="font-weight:800">${escapeHtml(route)}</div>
      <div class="small">Approved (Boarded): <strong>${approved}</strong></div>
      <div class="small">Pending: <strong>${pending}</strong></div>
      <div class="small">Driver: <strong>${drivers?escapeHtml(drivers.name):'Not assigned'}</strong></div>
      <div class="small">Phone: <strong>${drivers?escapeHtml(drivers.phone):'-'}</strong></div>
      <div style="margin-top:6px;font-weight:700;color:var(--accent2)">Vehicles needed: ${vehicles} (seats ${seats})</div>`;
    summaryGrid.appendChild(div);
  });
}

/* --------------------------
  Export: PDF report + CSV
--------------------------- */
document.getElementById('downloadReportPdf').addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'pt', format:'a4'});
  const title = `Eastern University — Daily Transport Report (${new Date().toLocaleDateString()})`;
  doc.setFontSize(14); doc.text(title, 40, 40);
  doc.setFontSize(11);
  let y = 64;
  doc.text('Route — Approved (Boarded) — Pending — Driver — Phone — Vehicles', 40, y); y+=14;
  const seats = Number(state.seatsPerBus) || 30;
  state.routes.forEach(route=>{
    const approved = state.requests.filter(r=>r.pickup===route && r.status==='Approved').length;
    const pending = state.requests.filter(r=>r.pickup===route && r.status==='Pending').length;
    const drv = state.drivers.find(d=>d.route===route);
    const vehicles = Math.ceil(approved / seats);
    const line = `${route} — ${approved} — ${pending} — ${drv?drv.name:'-'} — ${drv?drv.phone:'-'} — ${vehicles}`;
    doc.text(line, 40, y);
    y += 12;
    if(y > 760){ doc.addPage(); y = 40; }
  });
  // full requests listing (optional)
  y += 8;
  doc.addPage();
  doc.setFontSize(12);
  doc.text('Full requests (today)', 40, 40);
  let yy = 60;
  const todayKey = (new Date()).toISOString().slice(0,10);
  const todays = state.requests.filter(r=>r.timeISO.slice(0,10)===todayKey);
  if(todays.length === 0){
    doc.text('No requests today', 40, yy);
  } else {
    doc.setFontSize(9);
    doc.text('Time',40,yy); doc.text('Name',100,yy); doc.text('ID',260,yy); doc.text('Pickup',340,yy); doc.text('Status',420,yy);
    yy+=12;
    todays.forEach(r=>{
      const t = new Date(r.timeISO).toLocaleTimeString();
      doc.text(t,40,yy); doc.text(truncate(r.name,20),100,yy); doc.text(truncate(r.sid,16),260,yy); doc.text(truncate(r.pickup,18),340,yy); doc.text(r.status,420,yy);
      yy+=10;
      if(yy > 760){ doc.addPage(); yy = 40; }
    });
  }
  doc.save(`eu_transport_report_${(new Date()).toISOString().slice(0,10)}.pdf`);
});

document.getElementById('downloadCsv').addEventListener('click', ()=>{
  const rows = [['time','name','id','phone','pickup','status']];
  const todayKey = (new Date()).toISOString().slice(0,10);
  const todays = state.requests.filter(r=>r.timeISO.slice(0,10)===todayKey);
  todays.forEach(r=> rows.push([r.timeISO, r.name, r.sid, r.phone||'', r.pickup, r.status]));
  const csv = rows.map(r=> r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `eu_requests_${todayKey}.csv`; a.click(); URL.revokeObjectURL(url);
});

/* --------------------------
  Driver list PDF (separate)
--------------------------- */
document.getElementById('downloadDrivers')?.addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(14); doc.text('Eastern University — Drivers List', 14, 20);
  doc.setFontSize(11);
  let y = 36;
  const seats = Number(state.seatsPerBus) || 30;
  state.routes.forEach(route=>{
    const drv = state.drivers.find(d=>d.route===route);
    const approved = state.requests.filter(r=>r.pickup===route && r.status==='Approved').length;
    const line = `${route}: Driver: ${drv?drv.name:'-'} (${drv?drv.phone:'-'}) — Approved: ${approved}`;
    doc.text(line, 14, y);
    y+=12;
    if(y>780){ doc.addPage(); y=40;}
  });
  doc.save(`eu_drivers_${(new Date()).toISOString().slice(0,10)}.pdf`);
});

/* --------------------------
  Utilities
--------------------------- */
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
function truncate(s,n){ return s && s.length>n? s.slice(0,n-1)+'…' : s || ''; }

/* --------------------------
  Rendering helper wrappers
--------------------------- */
function renderRoutesDrivers(){ renderRoutesDrivers(); } // placeholder to avoid linter; actual used earlier

/* Re-render functions after changes */
function renderRoutesDrivers(){ /* already declared above */ }
function renderRequests(){ renderRequests(); } // placeholder
function renderSummary(){ renderSummary(); } // placeholder

// To avoid hoisting issues, call proper functions defined earlier
// (They were defined above; now ensure UI shows latest)
renderRoutesDrivers = function(){ /* already defined above but redeclare safe version: */ 
  // reusing the actual implementation above by just calling it: (we already have it)
  // However to ensure it runs correctly, simply call the original function body — but it's already defined earlier.
};
(function reconcileInit(){
  // ensure tables are up-to-date (call the actual implementations defined earlier)
  // because we defined renderRoutesDrivers and others already, just call the earlier init helpers:
  // The earlier definitions already executed init(); but ensure final sync:
  saveState();
  // Recreate UI with current state
  renderRoutesDrivers = function(){ /* create from scratch using same logic as earlier */ 
    // We'll reuse the earlier implementation by rebuilding DOM parts:
    // chips, drivers table, select
    routesChips.innerHTML = '';
    state.routes.forEach(r=>{ const d=document.createElement('div'); d.className='chip'; d.textContent=r; routesChips.appendChild(d); });
    driversTableBody.innerHTML = '';
    state.routes.forEach(r=>{
      const driver = state.drivers.find(x=>x.route===r);
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r}</td>
        <td>${driver?escapeHtml(driver.name):'<em>Not assigned</em>'}</td>
        <td>${driver?escapeHtml(driver.phone):'-'}</td>
        <td>
          <button class="btn.ghost" onclick="editDriverPrompt('${r.replace(/'/g,"\\'")}')">Edit</button>
          <button class="btn.ghost" onclick="deleteDriver('${r.replace(/'/g,"\\'")}')" style="margin-left:6px">Delete</button>
        </td>`;
      driversTableBody.appendChild(tr);
    });
    routesSelect.innerHTML = '<option value="">-- Select pickup location --</option>';
    state.routes.forEach(r=>{ const o=document.createElement('option'); o.value=r; o.textContent=r; routesSelect.appendChild(o); });
  };
  // call the implemented functions
  renderRoutesDrivers();
  renderRequests();
  renderSummary();
})();

/* ensure data persisted */
saveState();

</script>
</body>
</html>